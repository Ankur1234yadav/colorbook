{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Jquery moved here so it loads before everything else -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ColorBook</title>
    <!-- <link rel="icon" href="project3/letscolor/static/images/cute.jpg"> -->
    <link rel="stylesheet" href="{% static 'coloring.css' %}">
    
</head>
<body>
    {% include 'letscolor/navbar.html' %}
    <div class="tabletUp">

        <div class="drawing">
            <div class="top_drawing">

                <canvas id="canvas"></canvas>

                <div class="homeTablet_controls">
                
                    <div class="controls">

                        <div class="controls_front">
                            <!-- JSColor Picker -->
                            <p class="color-text">Color/Opacity: </p><input onInput="draw_color = this.value" value="#000000FF" class="color-picker color_opac" data-jscolor="{}">

                            <p class="color-text">Dropper Here: </p><input onInput="draw_color = this.value" type="color" class="color-picker"> 
                            
                            <p class="pen-text">Pen Size: <span id="pen-width"></span></p>
                            <input type="range" min="1" max="100" class="pen_range" id="penRange" >
                            
                            
                            <button onClick="erase_color()" type="button" class="erase button" id="erase">Erase <i class="fa fa-eraser"></i></button>

                            <div class="undo-redo">
                                <button onClick="undo_last()" type="button" class="undo button">Undo</button>
                                <button onClick="redo_last()" type="button" class="redo button" disabled>Redo</button>
                            </div>


                            <div class="download">
                                <div onClick="saveCanvas()" class="downloadText">
                                    <p>Download</p>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
            
            <a href="index.html" class="homeTablet"><i class="fas fa-house-damage"></i></a>
        <!-- .drawing end div -->
        </div> 

        <hr class="horizontal_rule">
        <div class="gallery">
            <div class="gallery-images">
                <div>
                    <img class="image" src="https://www.homemade-gifts-made-easy.com/image-files/kawaii-coloring-pages-400x518.png" alt="Cute Image" width="160" height="120" onclick="load_pic(this)">
                    <p>cute1</p>
                </div>

                <div>
                    <img class="image" onClick="load_pic(this)" src="https://img.freepik.com/free-vector/hand-drawn-kawaii-coloring-book-illustration_23-2149738641.jpg?size=338&ext=jpg&ga=GA1.1.735520172.1709078400&semt=ais"  width="160" height="120">
                    <p>cute2</p>
                </div>

                <div>
                    <img class="image" onClick="load_pic(this)" src="https://www.homemade-gifts-made-easy.com/image-files/kawaii-coloring-pages-cute-cupcake-with-strawberry-400x518.png"  width="160" height="120">
                    <p>cute3</p>
                </div> 

                 <div>
                    <img class="image" onClick="load_pic(this)" src="https://e7.pngegg.com/pngimages/234/378/png-clipart-coloring-book-christmas-coloring-pages-colouring-pages-child-animal-colouring-child-white-child-thumbnail.png" width="160" height="120">
                    <p>cute4</p>
                </div> 
                <div>
                    <img class="image" onClick="load_pic(this)" src="https://i.pinimg.com/736x/c5/ca/d3/c5cad3c57cef85229c5f9aaca2a734e7.jpg" width="160" height="120">
                    <p>cute4</p>
                </div> 
                <div>
                    <img class="image" onClick="load_pic(this)" src="https://img.freepik.com/free-vector/hand-drawn-kawaii-coloring-book-illustration_23-2149716109.jpg?size=338&ext=jpg&ga=GA1.1.1395880969.1709251200&semt=ais" width="160" height="120">
                    <p>cute4</p>
                </div> 
                <div>
                    <img class="image" onClick="load_pic(this)" src="https://i.pinimg.com/736x/46/b2/e6/46b2e65c7997dbd5f3539bf7a31d3e36.jpg" width="160" height="120">
                    <p>cute4</p>
                </div> 
                <div>
                    <img class="image" onClick="load_pic(this)" src="https://teachmint.storage.googleapis.com/public/836539394/Assignment/e5a9648e-b550-400e-b7b4-49520f5bf24c.jpg" width="160" height="120">
                    <p>cute4</p>
                </div> 
                <div>
                    <img class="image" onClick="load_pic(this)" src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTgY8xeQlLKvG3tfK_fuIlaxDFlWqr6WOYzTw&usqp=CAU" width="160" height="120">
                    <p>cute4</p>
                </div> 
                <div>
                    <img class="image" onClick="load_pic(this)" src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQuNZhJ1t_jczI786Mfn_cdGPeROMK_Pa6cQQ&usqp=CAU" width="160" height="120">
                    <p>cute4</p>
                </div> 
                <div>
                    <img class="image" onClick="load_pic(this)" src="https://thumbs.dreamstime.com/b/whale-coloring-page-kids-cute-funny-provides-hours-fun-children-to-color-very-easy-suitable-little-toddlers-236788983.jpg" width="160" height="120">
                    <p>cute4</p>
                </div> 
                <div>
                    <img class="image" onClick="load_pic(this)" src="https://static.vecteezy.com/system/resources/thumbnails/015/868/057/small_2x/whale-coloring-page-colored-illustration-vector.jpg" width="160" height="120">
                    <p>cute4</p>
                </div> 
                <div>
                    <img class="image" onClick="load_pic(this)" src="https://www.coloringpages-forkids.com/minis-menu/minis-sm/jumping-unicorn.png" width="160" height="120">
                    <p>cute4</p>
                </div> 



            
            </div> <!-- gallery-images end div -->
        
        </div>

        

        <hr class="horizontal_rule">

        <div class="nav_tablet">
            <button onClick="reset_canvas()" type="button" class="reset button">Destroy Painting</button>
        </div>

    <!-- tableUp end div -->
    </div>

    <script>
        
    const canvas = document.querySelector("#canvas");
    const context = canvas.getContext("2d");


    canvas.height = 500;
    canvas.width = 500;

    let start_background_color = "#B7B7B7CF";
    context.fillStyle = start_background_color;
    context.fillRect(0, 0, canvas.width, canvas.height);


    // Variables
    let draw_color = "black";
    let draw_width = "10";
    let is_drawing = false;

    let slider = document.getElementById("penRange");
    let output = document.getElementById("pen-width");
    output.textContent = slider.value;

    let imageValue;
    
    //Array

    let store_array = [];
    let index = -1;

    let removed_array = [];
    let indexRemoved = -1;

    // EventListeners

    // For mobile and tablets
    canvas.addEventListener("touchstart", start, false);
    canvas.addEventListener("touchmove", draw, false);
    canvas.addEventListener("touchend", stop, false);


    // For computer
    canvas.addEventListener("mousedown", start);
    canvas.addEventListener("mousemove", draw);

    canvas.addEventListener("mouseup", stop, false);
    canvas.addEventListener("mouseout", stop, false);


    function start(event) {
        is_drawing = true;
        draw(event); //needed to make dots
        
        event.preventDefault(); //To prevent default changes to appear
    }

    function draw(event) {
        if(is_drawing) {
            context.lineTo(event.clientX-canvas.offsetLeft, event.clientY-canvas.offsetLeft);

            context.strokeStyle = draw_color;
            context.lineWidth = draw_width;
            context.lineCap = "round";
            context.lineJoin = "round"; //To get a full line with less interruptions
            
            context.stroke();

            //To make path smoother
            context.beginPath();
            context.moveTo(event.clientX-canvas.offsetLeft, event.clientY-canvas.offsetLeft);

            event.preventDefault();
        }
    }

    function stop(event) {
        if (is_drawing) {
            context.stroke();
            context.closePath();
            is_drawing = false;

            store_array.push(context.getImageData(0, 0, canvas.width, canvas.height));

            index += 1;
        
        }
        context.beginPath(); //to close the path if pen goes off the canvas

        event.preventDefault();

    }

    // Pen Width
    slider.oninput = function () {
        draw_width = this.value;
        output.textContent = this.value;
    }

    // UNDO 
    function undo_last() {
        if (index === 0) {
            context.clearRect(0, 0, canvas.width, canvas.height);
            context.fillStyle = start_background_color;
            context.fillRect(0, 0, canvas.width, canvas.height);
        } else if (index < 0) {
            reset_canvas();
        } else {
            
            removed_array.push(context.getImageData(0, 0, canvas.width, canvas.height));
            indexRemoved += 1;
            
            store_array.pop();
            index -= 1;

            context.putImageData(store_array[index], 0, 0);

            document.querySelector(".redo").disabled = false;
        }
    }

    // REDO 
    function redo_last() {
        if (index === -1)  {
            context.putImageData(removedLast[0], 0, 0);
            store_array.push(context.getImageData(0, 0, canvas.width, canvas.height));
            index += 1;
        } else {
            context.putImageData(removed_array[indexRemoved], 0, 0);
            removed_array.pop();
            indexRemoved -= 1;

            //to put the returned imaged back to the restore_array

            store_array.push(context.getImageData(0, 0, canvas.width, canvas.height));
            index += 1;

            if (removed_array.indexOf(removed_array[indexRemoved]) === -1) {
                document.querySelector(".redo").disabled = true; //Needed to prevent error
            }
        }
    }

    // ERASE
    function erase_color() {
        //To prevent the color of the main background
        draw_color = "white";
    
        // context.globalCompositeOperation = 'destination-out'
    }

    // RESET CANVAS
    function reset_canvas() {
        //declaring the fill's color 
        context.clearRect(0, 0, canvas.width, canvas.height); //clears the background
        context.fillStyle = "#f000c3";
        context.fillRect(0, 0, canvas.width, canvas.height); //refills with white again



        drawing_image("https://www.homemade-gifts-made-easy.com/image-files/kawaii-coloring-pages-400x518.png")

        //reset array and index
        store_array = [];
        index = -1;
    
        removed_array = [];
        indexRemoved = -1;

        document.querySelector(".redo").disabled = true;
    }

    // LOADING IMAGE
    function load_pic(element) {
    let imageValue = element.src;
    drawing_image(imageValue);
}

function drawing_image(image) {
    let newImage = new Image();

    newImage.onload = function() {
        if (context) {
            context.clearRect(0, 0, canvas.width, canvas.height); // Clearing the canvas
            context.drawImage(newImage, 0, 0, canvas.width, canvas.height);
            store_array.push(context.getImageData(0, 0, canvas.width, canvas.height));
            index += 1; 
        } else {
            console.error("Canvas context is not available.");
        }
    };

    newImage.onerror = function() {
        console.error("Failed to load the image: " + image);
    };

    if (image !== undefined) {
        newImage.src = image;
    } else {
        console.error("Image source is undefined.");
    }
}

    // SAVE CANVAS
    function saveCanvas() {
    try {
        const url = canvas.toDataURL();
        const a = document.createElement("a");
        a.href = url;
        a.download = "canvas-image.png";
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
    } catch (error) {
        console.error("Error saving canvas:", error);
        alert("Failed to save canvas. Please try again.");
    }
}



    

// });
    </script>




{% include 'letscolor/footer.html' %}
    
</body> 
</html>